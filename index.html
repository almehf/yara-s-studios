<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Yara Studios - Phone Verification</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <style>
      body {
        font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      }
    </style>
  </head>
  <body class="min-h-screen bg-[#FDF6EC]">
    <div id="root"></div>

    <script>
      (function () {
        const { useState, useEffect } = React;

        const API_KEY = "$2y$10$e39ybF/y0Jq1z5yM3Lusce5KtlBK1HR5Jz5Aiv1FCS2VgkC603U2q";
        const API_BASE = "https://api.authentica.sa/api/v2";

        const icons = {
          loader2: "M12 3v3m0 12v3m7.78-13.78-2.12 2.12M6.34 17.66l-2.12 2.12M21 12h-3M6 12H3m13.66 5.66-2.12-2.12M8.46 8.46 6.34 6.34",
          sendAlt: "m22 2-7 20-4-9-9-4Z",
          checkCircle: "M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z",
          phone: "M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92Z",
          keyRound: "m21 2-2 2m-5.5 5.5L11 12l-1 4-2 2H4l6-6M17.5 9.5 15 7l3-3 2.5 2.5-3 3Zm-3.75-1a3.5 3.5 0 1 1-4.95-4.95 3.5 3.5 0 0 1 4.95 4.95Z",
          x: "M6 6l12 12M6 18 18 6",
        };

        const Icon = ({ path, className = "w-5 h-5" }) =>
          React.createElement(
            "svg",
            {
              xmlns: "http://www.w3.org/2000/svg",
              fill: "none",
              viewBox: "0 0 24 24",
              strokeWidth: "1.5",
              stroke: "currentColor",
              className,
            },
            React.createElement("path", { strokeLinecap: "round", strokeLinejoin: "round", d: path })
          );

        function App() {
          const [phoneNumber, setPhoneNumber] = useState("");
          const [otp, setOtp] = useState("");
          const [isSendingOtp, setIsSendingOtp] = useState(false);
          const [isVerifying, setIsVerifying] = useState(false);
          const [otpSent, setOtpSent] = useState(false);
          const [toastMessage, setToastMessage] = useState(null);

          useEffect(() => {
            if (toastMessage) {
              const timer = setTimeout(() => setToastMessage(null), 5000);
              return () => clearTimeout(timer);
            }
          }, [toastMessage]);

          const showToast = ({ title, description, variant }) => setToastMessage({ title, description, variant });

          const validateAndFormatPhone = (input) => {
            const digits = input.replace(/\D/g, "");
            if (digits.startsWith("966") && digits.length === 12) return "+" + digits;
            if (digits.startsWith("0") && digits.length === 10) return "+966" + digits.substring(1);
            if (!digits.startsWith("966") && !digits.startsWith("0") && digits.length === 9) return "+966" + digits;
            return null;
          };

          const isValidSaudiPhone = (input) => {
            const digits = input.replace(/\D/g, "");
            if (digits.startsWith("966") && digits.length === 12) return true;
            if (digits.startsWith("0") && digits.length === 10) return true;
            if (!digits.startsWith("966") && !digits.startsWith("0") && digits.length === 9) return true;
            return false;
          };

          const handleSendOtp = async () => {
            if (!isValidSaudiPhone(phoneNumber)) {
              showToast({
                title: "Invalid Phone Number",
                description: "Please enter a valid Saudi phone number (e.g., +966 5XX XXX XXX, 05XX XXX XXX)",
                variant: "destructive",
              });
              return;
            }

            const formattedPhone = validateAndFormatPhone(phoneNumber);
            setIsSendingOtp(true);

            try {
              const response = await fetch(`${API_BASE}/send-otp`, {
                method: "POST",
                headers: {
                  "X-Authorization": API_KEY,
                  Accept: "application/json",
                  "Content-Type": "application/json",
                },
                body: JSON.stringify({ method: "sms", phone: formattedPhone }),
              });

              const data = await response.json();
              if (response.ok && data.success !== false) {
                setOtpSent(true);
                showToast({ title: "OTP Sent", description: "A verification code has been sent to your phone" });
              } else {
                showToast({
                  title: "Failed to Send OTP",
                  description: data.message || "Please try again",
                  variant: "destructive",
                });
              }
            } catch (err) {
              showToast({
                title: "Network Error",
                description: "Could not send OTP. Check your connection.",
                variant: "destructive",
              });
            } finally {
              setIsSendingOtp(false);
            }
          };

          const handleVerifyOtp = async () => {
            if (!otp || otp.length < 4) {
              showToast({
                title: "Invalid Code",
                description: "Please enter the verification code",
                variant: "destructive",
              });
              return;
            }

            const formattedPhone = validateAndFormatPhone(phoneNumber);
            setIsVerifying(true);

            try {
              const response = await fetch(`${API_BASE}/verify-otp`, {
                method: "POST",
                headers: {
                  "X-Authorization": API_KEY,
                  Accept: "application/json",
                  "Content-Type": "application/json",
                },
                body: JSON.stringify({ phone: formattedPhone, otp }),
              });

              const data = await response.json();
              if (response.ok && data.success !== false) {
                showToast({ title: "Verified", description: "Your phone number has been verified successfully!" });
              } else {
                showToast({
                  title: "Verification Failed",
                  description: data.message || "The code is incorrect. Please try again.",
                  variant: "destructive",
                });
              }
            } catch (err) {
              showToast({
                title: "Network Error",
                description: "Could not verify OTP. Check your connection.",
                variant: "destructive",
              });
            } finally {
              setIsVerifying(false);
            }
          };

          const toastEl =
            toastMessage &&
            React.createElement(
              "div",
              { className: "fixed top-4 right-4 z-50 max-w-md w-full" },
              React.createElement(
                "div",
                {
                  className: `rounded-lg shadow-lg p-4 border ${
                    toastMessage.variant === "destructive" ? "bg-red-50 border-red-200" : "bg-green-50 border-green-200"
                  }`,
                },
                React.createElement(
                  "div",
                  { className: "flex items-start justify-between gap-3" },
                  React.createElement(
                    "div",
                    { className: "flex-1" },
                    React.createElement("h3", { className: "font-semibold text-sm mb-1" }, toastMessage.title),
                    React.createElement("p", { className: "text-sm opacity-80" }, toastMessage.description)
                  ),
                  React.createElement(
                    "button",
                    {
                      onClick: () => setToastMessage(null),
                      className: "text-gray-500 hover:text-gray-700 transition-colors",
                      "aria-label": "Close toast",
                    },
                    React.createElement(Icon, { path: icons.x, className: "w-4 h-4" })
                  )
                )
              )
            );

          return React.createElement(
            "div",
            { className: "min-h-screen bg-[#FDF6EC] flex items-center justify-center p-4 relative" },
            toastEl,
            React.createElement(
              "div",
              { className: "w-full max-w-md" },
              React.createElement(
                "div",
                { className: "text-center mb-10" },
                React.createElement("img", {
                  src: "https://qtrypzzcjebvfcihiynt.supabase.co/storage/v1/object/public/base44-prod/public/user_68b599becd811415d7f1207e/6e7aaaf04_ChatGPTImageDec72025at06_31_42PM.png",
                  alt: "Yara Studios",
                  className: "w-48 h-auto mx-auto",
                })
              ),
              React.createElement(
                "div",
                { className: "bg-white/80 backdrop-blur-sm rounded-3xl shadow-xl shadow-[#D2744A]/10 p-8 border border-white/50" },
                React.createElement(
                  "h2",
                  { className: "text-2xl font-semibold text-[#1E3A4F] text-center mb-2" },
                  "Phone Verification"
                ),
                React.createElement(
                  "p",
                  { className: "text-[#1E3A4F]/60 text-center text-sm mb-8" },
                  "Enter your Saudi phone number to receive a verification code"
                ),
                React.createElement(
                  "div",
                  { className: "space-y-4 mb-6" },
                  React.createElement(
                    "div",
                    { className: "relative" },
                    React.createElement(
                      "div",
                      { className: "absolute left-4 top-1/2 -translate-y-1/2 text-[#D2744A]" },
                      React.createElement(Icon, { path: icons.phone })
                    ),
                    React.createElement("input", {
                      type: "tel",
                      placeholder: "+966 5XX XXX XXX or 05XX XXX XXX",
                      value: phoneNumber,
                      onChange: (e) => setPhoneNumber(e.target.value),
                      onKeyDown: (e) => {
                        if (e.key === "Enter" && phoneNumber) handleSendOtp();
                      },
                      className:
                        "pl-12 h-14 text-lg rounded-xl border border-[#1E3A4F]/10 focus:border-[#D2744A] focus:ring-2 focus:ring-[#D2744A]/20 bg-white w-full outline-none",
                      dir: "ltr",
                    })
                  ),
                  React.createElement(
                    "button",
                    {
                      onClick: handleSendOtp,
                      disabled: isSendingOtp || !phoneNumber,
                      className:
                        "w-full h-14 text-lg font-medium rounded-xl bg-[#D2744A] hover:bg-[#C16439] text-white transition-all duration-300 shadow-lg shadow-[#D2744A]/30 disabled:opacity-60 disabled:cursor-not-allowed flex items-center justify-center",
                    },
                    isSendingOtp
                      ? React.createElement(Icon, { path: icons.loader2, className: "w-5 h-5 animate-spin mr-2" })
                      : React.createElement(Icon, { path: icons.sendAlt, className: "w-5 h-5 mr-2" }),
                    "Send"
                  )
                ),
                React.createElement(
                  "div",
                  { className: "relative my-8" },
                  React.createElement(
                    "div",
                    { className: "absolute inset-0 flex items-center" },
                    React.createElement("div", { className: "w-full border-t border-[#1E3A4F]/10" })
                  ),
                  React.createElement(
                    "div",
                    { className: "relative flex justify-center text-sm" },
                    React.createElement("span", { className: "px-4 bg-white text-[#1E3A4F]/40" }, "Enter verification code")
                  )
                ),
                React.createElement(
                  "div",
                  { className: `space-y-4 ${otpSent ? "opacity-100" : "opacity-50"}` },
                  React.createElement(
                    "div",
                    { className: "relative" },
                    React.createElement(
                      "div",
                      { className: "absolute left-4 top-1/2 -translate-y-1/2 text-[#D2744A]" },
                      React.createElement(Icon, { path: icons.keyRound })
                    ),
                    React.createElement("input", {
                      type: "text",
                      placeholder: "Enter OTP code",
                      value: otp,
                      onChange: (e) => setOtp(e.target.value.replace(/\D/g, "").slice(0, 6)),
                      onKeyDown: (e) => {
                        if (e.key === "Enter" && otp && otpSent) handleVerifyOtp();
                      },
                      className:
                        "pl-12 h-14 text-lg text-center tracking-[0.5em] font-mono rounded-xl border border-[#1E3A4F]/10 focus:border-[#D2744A] focus:ring-2 focus:ring-[#D2744A]/20 bg-white w-full outline-none",
                      maxLength: 6,
                      dir: "ltr",
                    })
                  ),
                  React.createElement(
                    "button",
                    {
                      onClick: handleVerifyOtp,
                      disabled: isVerifying || !otp || !otpSent,
                      className:
                        "w-full h-14 text-lg font-medium rounded-xl bg-[#1E3A4F] hover:bg-[#152D3D] text-white transition-all duration-300 shadow-lg shadow-[#1E3A4F]/20 disabled:opacity-60 disabled:cursor-not-allowed flex items-center justify-center",
                    },
                    isVerifying
                      ? React.createElement(Icon, { path: icons.loader2, className: "w-5 h-5 animate-spin mr-2" })
                      : React.createElement(Icon, { path: icons.checkCircle, className: "w-5 h-5 mr-2" }),
                    "Verify"
                  )
                )
              ),
              React.createElement(
                "p",
                { className: "text-center text-[#1E3A4F]/40 text-sm mt-8" },
                "Â© 2025 Yara Studios. All rights reserved."
              )
            )
          );
        }

        const root = ReactDOM.createRoot(document.getElementById("root"));
        root.render(React.createElement(App));
      })();
    </script>
  </body>
</html>
